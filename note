#!/usr/bin/env python3
"""note: One daily note, dead simple."""

import os
import sys
from datetime import datetime
from pathlib import Path

NOTES_DIR = Path.home() / ".notes"
NOTES_DIR.mkdir(exist_ok=True)


def today_file():
    return NOTES_DIR / f"{datetime.now().strftime('%Y-%m-%d')}.txt"


def add_note(text):
    with open(today_file(), "a") as f:
        time = datetime.now().strftime("%H:%M")
        f.write(f"[{time}] {text}\n")
    print(f"Noted.")


def show_today():
    f = today_file()
    if f.exists():
        date = datetime.now().strftime("%Y-%m-%d")
        print(f"\033[1m{date}\033[0m")
        print(f.read_text())
    else:
        print("No notes today. Add one: note <your note>")


def show_all():
    files = sorted(NOTES_DIR.glob("*.txt"), reverse=True)[:7]
    for f in files:
        date = f.stem
        print(f"\033[1m{date}\033[0m")
        print(f.read_text())


def main():
    if len(sys.argv) < 2:
        show_today()
    elif sys.argv[1] == "-a" or sys.argv[1] == "--all":
        show_all()
    elif sys.argv[1] == "-h" or sys.argv[1] == "--help":
        print("note <text>  - Add a note")
        print("note         - Show today's notes")
        print("note -a      - Show last 7 days")
    else:
        add_note(" ".join(sys.argv[1:]))


if __name__ == "__main__":
    main()
